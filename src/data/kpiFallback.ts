import type {
  ContractKpiLatestResponse,
  ContractRightPanelLatest,
  ContractRightPanelSeries,
} from '../api'

type MetricDetail = NonNullable<ContractKpiLatestResponse['metrics'][string]>

const cloneMetric = (point: MetricDetail): MetricDetail => ({
  date: point.date,
  actual: point.actual,
  planned: point.planned,
})

const CONTRACT_KPI_LATEST_DETAILS: Record<string, ContractKpiLatestResponse> = {
  'mw-01-main-dam': {
    metrics: {
      ac: { date: '2025-10-12', actual: 194593.23, planned: null },
      const_output: { date: '2025-10-12', actual: 68.2353983375591, planned: 72.65440406301427 },
      cpi: { date: '2025-10-12', actual: 0.9169052265592249, planned: null },
      design_output: { date: '2025-10-12', actual: 37.852791140303516, planned: 41.01009985152708 },
      ev: { date: '2025-10-12', actual: 135725.00440730856, planned: null },
      ncr_closed: { date: '2025-10-12', actual: 22.0, planned: null },
      ncr_open: { date: '2025-10-12', actual: 17.0, planned: null },
      prep_output: { date: '2025-10-12', actual: 34.50791524565987, planned: 39.5241991298152 },
      prod_actual_pct: { date: '2025-10-12', actual: 68.76072177345556, planned: 71.10619152214007 },
      prod_planned_pct: { date: '2025-10-12', actual: 71.10619152214007, planned: 71.10619152214007 },
      pv: { date: '2025-10-12', actual: 164650.9834992303, planned: null },
      qaor_closed: { date: '2025-10-12', actual: 12.0, planned: null },
      qaor_open: { date: '2025-10-12', actual: 10.0, planned: null },
      quality_conf: { date: '2025-10-12', actual: 87.93219745227695, planned: null },
      schedule_progress_pct: { date: '2025-10-12', actual: 82.86788650711907, planned: null },
      spi: { date: '2025-10-12', actual: 0.9833333333333334, planned: null },
    },
  },
}

const CONTRACT_RIGHT_PANEL_SERIES: Record<string, Record<string, ContractRightPanelSeries>> = {
  'mw-01-main-dam': {
    prod_actual_pct: {
      dates: [
        '2025-09-15',
        '2025-09-16',
        '2025-09-17',
        '2025-09-18',
        '2025-09-19',
        '2025-09-20',
        '2025-09-21',
        '2025-09-22',
        '2025-09-23',
        '2025-09-24',
        '2025-09-25',
        '2025-09-26',
        '2025-09-27',
        '2025-09-28',
        '2025-09-29',
        '2025-09-30',
        '2025-10-01',
        '2025-10-02',
        '2025-10-03',
        '2025-10-04',
        '2025-10-05',
        '2025-10-06',
        '2025-10-07',
        '2025-10-08',
        '2025-10-09',
        '2025-10-10',
        '2025-10-11',
        '2025-10-12',
      ],
      actual: [
        71.9217260616437,
        74.5292157406077,
        60.676587131597465,
        69.49879860135296,
        76.02673954856873,
        59.46323036685593,
        61.34622119761826,
        65.76760776483492,
        63.94489012635421,
        54.11666625139699,
        74.19097771148633,
        65.33246761606097,
        69.38347897209997,
        57.54768196716062,
        72.45094361434214,
        58.02340397536015,
        59.33450140285499,
        58.755287683432186,
        71.6148595683813,
        72.12305621657352,
        66.09574794791176,
        69.35435519772678,
        61.3460906345989,
        81.19938646995585,
        63.94527558161201,
        76.58264932877208,
        66.49112854746447,
        68.76072177345556,
      ],
      planned: [
        76.57876082204689,
        79.24000923160922,
        71.93495661556248,
        70.80607048435375,
        78.4032015327309,
        67.25120279198653,
        63.04057440772002,
        70.06570437038091,
        71.85933899994711,
        57.20733880109592,
        78.88391139158226,
        67.51336445160224,
        76.16071432164834,
        59.68181660903568,
        77.0742888001886,
        66.70270184981644,
        65.22584329867314,
        65.75674016219648,
        78.90370040044535,
        76.31074047816176,
        69.89501324817303,
        73.19793371370115,
        72.05565794967674,
        84.42228409117568,
        67.58284432927464,
        86.06579776124842,
        72.8911579806829,
        71.10619152214007,
      ],
    },
    prod_planned_pct: {
      dates: [
        '2025-09-15',
        '2025-09-16',
        '2025-09-17',
        '2025-09-18',
        '2025-09-19',
        '2025-09-20',
        '2025-09-21',
        '2025-09-22',
        '2025-09-23',
        '2025-09-24',
        '2025-09-25',
        '2025-09-26',
        '2025-09-27',
        '2025-09-28',
        '2025-09-29',
        '2025-09-30',
        '2025-10-01',
        '2025-10-02',
        '2025-10-03',
        '2025-10-04',
        '2025-10-05',
        '2025-10-06',
        '2025-10-07',
        '2025-10-08',
        '2025-10-09',
        '2025-10-10',
        '2025-10-11',
        '2025-10-12',
      ],
      actual: [
        76.57876082204689,
        79.24000923160922,
        71.93495661556248,
        70.80607048435375,
        78.4032015327309,
        67.25120279198653,
        63.04057440772002,
        70.06570437038091,
        71.85933899994711,
        57.20733880109592,
        78.88391139158226,
        67.51336445160224,
        76.16071432164834,
        59.68181660903568,
        77.0742888001886,
        66.70270184981644,
        65.22584329867314,
        65.75674016219648,
        78.90370040044535,
        76.31074047816176,
        69.89501324817303,
        73.19793371370115,
        72.05565794967674,
        84.42228409117568,
        67.58284432927464,
        86.06579776124842,
        72.8911579806829,
        71.10619152214007,
      ],
      planned: [
        76.57876082204689,
        79.24000923160922,
        71.93495661556248,
        70.80607048435375,
        78.4032015327309,
        67.25120279198653,
        63.04057440772002,
        70.06570437038091,
        71.85933899994711,
        57.20733880109592,
        78.88391139158226,
        67.51336445160224,
        76.16071432164834,
        59.68181660903568,
        77.0742888001886,
        66.70270184981644,
        65.22584329867314,
        65.75674016219648,
        78.90370040044535,
        76.31074047816176,
        69.89501324817303,
        73.19793371370115,
        72.05565794967674,
        84.42228409117568,
        67.58284432927464,
        86.06579776124842,
        72.8911579806829,
        71.10619152214007,
      ],
    },
    design_output: {
      dates: [
        '2025-09-16',
        '2025-09-17',
        '2025-09-18',
        '2025-09-19',
        '2025-09-21',
        '2025-09-22',
        '2025-09-23',
        '2025-09-24',
        '2025-09-25',
        '2025-09-26',
        '2025-09-28',
        '2025-09-29',
        '2025-10-01',
        '2025-10-02',
        '2025-10-03',
        '2025-10-04',
        '2025-10-05',
        '2025-10-06',
        '2025-10-07',
        '2025-10-08',
        '2025-10-09',
        '2025-10-12',
      ],
      actual: [
        58.57870485645407,
        53.308551130355646,
        70.17901455943858,
        76.04734005044206,
        63.8282183936008,
        54.667395389525026,
        39.159283874330235,
        44.532361109719545,
        62.94764100337099,
        54.270441563254884,
        49.44819937377122,
        71.1659686901018,
        77.9577214501097,
        44.88502939128365,
        70.35523801593173,
        70.972558293034,
        67.4928007548602,
        49.07648833571806,
        64.22973457008527,
        86.18997346526868,
        53.302954123998596,
        37.852791140303516,
      ],
      planned: [
        60.506636812273165,
        59.57934216234077,
        71.0021361360179,
        79.37749454214585,
        65.10110155526809,
        65.35530234094458,
        40.88429907415203,
        44.815244124986314,
        71.31233074331975,
        57.805307604875985,
        56.00180253847459,
        76.20567519774603,
        78.74984560568194,
        47.05194632297418,
        72.06365054760953,
        75.79003248952029,
        67.17350476915588,
        50.65827828297133,
        77.44528563506098,
        90.89370198518054,
        57.21677197615083,
        41.01009985152708,
      ],
    },
    prep_output: {
      dates: [
        '2025-09-15',
        '2025-09-16',
        '2025-09-17',
        '2025-09-18',
        '2025-09-19',
        '2025-09-20',
        '2025-09-21',
        '2025-09-22',
        '2025-09-23',
        '2025-09-24',
        '2025-09-25',
        '2025-09-26',
        '2025-09-27',
        '2025-09-28',
        '2025-09-29',
        '2025-09-30',
        '2025-10-02',
        '2025-10-03',
        '2025-10-04',
        '2025-10-05',
        '2025-10-06',
        '2025-10-07',
        '2025-10-08',
        '2025-10-09',
        '2025-10-10',
        '2025-10-12',
      ],
      actual: [
        35.75573103383546,
        70.4612373526512,
        39.762127656692115,
        72.50257654601207,
        80.77676868073117,
        55.954523059786474,
        26.441212013619555,
        84.76791222336819,
        54.178896951820384,
        31.3073272701628,
        34.197733678975666,
        37.29846093098462,
        52.892095449069906,
        40.47833893004661,
        63.67680247114921,
        69.42256368351373,
        64.85882707724141,
        71.5148068581164,
        70.972558293034,
        67.4928007548602,
        39.36656130546848,
        52.24285735237302,
        78.06952446744268,
        60.170637156164645,
        73.1360492368461,
        34.50791524565987,
      ],
      planned: [
        41.46830782431267,
        78.33097002558253,
        44.6979098242738,
        71.19552432032465,
        85.3066159438061,
        60.44351242465525,
        31.425506560505166,
        83.34903758479676,
        64.87232208458215,
        32.88956569481394,
        40.87480821465593,
        38.622100274058354,
        55.43855569930584,
        44.656891895136134,
        68.51981806495321,
        75.984752165417,
        69.97588068447055,
        77.60306106618901,
        75.79003248952029,
        67.17350476915588,
        44.91869521246569,
        61.073647156989644,
        84.20427090414667,
        66.64491909281335,
        84.48393188673852,
        39.5241991298152,
      ],
    },
    const_output: {
      dates: [
        '2025-09-15',
        '2025-09-16',
        '2025-09-17',
        '2025-09-18',
        '2025-09-19',
        '2025-09-20',
        '2025-09-21',
        '2025-09-22',
        '2025-09-23',
        '2025-09-24',
        '2025-09-25',
        '2025-09-26',
        '2025-09-27',
        '2025-09-28',
        '2025-09-29',
        '2025-09-30',
        '2025-10-01',
        '2025-10-02',
        '2025-10-03',
        '2025-10-05',
        '2025-10-06',
        '2025-10-07',
        '2025-10-08',
        '2025-10-09',
        '2025-10-10',
        '2025-10-11',
        '2025-10-12',
      ],
      actual: [
        64.18956236762298,
        66.18064270415472,
        60.676587131597465,
        68.04359495473793,
        56.89924799002255,
        47.96675967994366,
        69.81395712255072,
        55.03360023523495,
        59.40664614539376,
        53.79561948537858,
        64.15368378534224,
        54.81054199487269,
        52.892095449069906,
        41.56807014033346,
        67.9190320910602,
        69.42256368351373,
        49.92499052912435,
        55.53591298972146,
        65.07633994830029,
        45.53443370918033,
        58.05736926637536,
        56.73894067645738,
        61.82862647179066,
        38.42064145302824,
        74.28062829279654,
        52.21454022985185,
        68.2353983375591,
      ],
      planned: [
        66.39217548689379,
        74.48820665782407,
        71.93495661556248,
        72.27379504149894,
        60.78175102113037,
        50.45080389749418,
        72.12854752805049,
        60.99583767650561,
        69.68865134937427,
        53.170874731033024,
        72.19777770545552,
        56.66218466430723,
        55.43855569930584,
        44.175496943141496,
        69.59663127454955,
        75.984752165417,
        52.787939066762135,
        60.997896808620474,
        70.69923832927294,
        46.156002352890276,
        62.21820572449283,
        66.80292472308716,
        70.82540874207893,
        38.67920733731234,
        86.88537309449866,
        54.795755787284065,
        72.65440406301427,
      ],
    },
    spi: {
      dates: [
        '2025-09-15',
        '2025-09-16',
        '2025-09-17',
        '2025-09-18',
        '2025-09-19',
        '2025-09-20',
        '2025-09-21',
        '2025-09-22',
        '2025-09-23',
        '2025-09-24',
        '2025-09-25',
        '2025-09-26',
        '2025-09-27',
        '2025-09-28',
        '2025-09-29',
        '2025-09-30',
        '2025-10-01',
        '2025-10-02',
        '2025-10-03',
        '2025-10-04',
        '2025-10-05',
        '2025-10-06',
        '2025-10-07',
        '2025-10-08',
        '2025-10-09',
        '2025-10-10',
        '2025-10-11',
        '2025-10-12',
      ],
      actual: [
        1.1049999999999998,
        1.0516666666666667,
        1.0450000000000002,
        1.015,
        1.0450000000000002,
        1.0166666666666666,
        1.07,
        0.9899999999999999,
        1.0116666666666667,
        1.0416666666666667,
        1.0383333333333333,
        0.9900000000000001,
        1.0633333333333335,
        1.0216666666666667,
        0.9933333333333332,
        1.0116666666666667,
        1.0666666666666667,
        0.9366666666666666,
        0.9700000000000001,
        1.0200000000000002,
        0.9883333333333333,
        1.0483333333333336,
        1.0566666666666666,
        1.0183333333333335,
        1.0083333333333335,
        0.9466666666666667,
        0.9900000000000001,
        0.9833333333333334,
      ],
      planned: Array(28).fill(0),
    },
  },
}

const cloneSeries = (series: ContractRightPanelSeries): ContractRightPanelSeries => ({
  dates: [...series.dates],
  actual: [...series.actual],
  planned: [...series.planned],
})

const buildRightPanelLatest = (payload: ContractKpiLatestResponse): ContractRightPanelLatest => {
  const latest: Record<string, number | null> = {}
  Object.entries(payload.metrics).forEach(([metric, point]) => {
    latest[metric] = point.actual ?? null
  })
  return { latest }
}

export function getContractKpiLatestDetailedFallback(contractId: string): ContractKpiLatestResponse | null {
  const payload = CONTRACT_KPI_LATEST_DETAILS[contractId]
  if (!payload) {
    return null
  }
  const metrics: Record<string, MetricDetail> = {}
  Object.entries(payload.metrics).forEach(([metric, point]) => {
    metrics[metric] = cloneMetric(point)
  })
  return { metrics }
}

export function getContractKpiLatestFallback(contractId: string): ContractRightPanelLatest | null {
  const detailed = getContractKpiLatestDetailedFallback(contractId)
  if (!detailed) {
    return null
  }
  return buildRightPanelLatest(detailed)
}

export function getContractKpiSeriesFallback(
  contractId: string,
  metric: string,
): ContractRightPanelSeries | null {
  const series = CONTRACT_RIGHT_PANEL_SERIES[contractId]?.[metric]
  if (!series) {
    return null
  }
  return cloneSeries(series)
}

